<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>🌱 Bibliothèque Botanique - Application Météo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 50%, #e8f5e8 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .nav-tabs {
            display: flex;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-radius: 15px 15px 0 0;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
            margin-bottom: 0;
            overflow: hidden;
        }

        .nav-tabs a {
            flex: 1;
            padding: 18px 25px;
            text-decoration: none;
            color: white;
            text-align: center;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
        }

        .nav-tabs a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #e8f5e8;
            transform: translateY(-2px);
        }

        .nav-tabs a.active {
            background: linear-gradient(135deg, #66BB6A, #4CAF50);
            color: white;
            border-bottom-color: #81C784;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-tabs a.active::after {
            content: '🌱';
            position: absolute;
            top: -5px;
            right: 10px;
            font-size: 16px;
        }

        .hero-section {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 50%, #81C784 100%);
            border-radius: 0 0 20px 20px;
            padding: 40px 30px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 32px rgba(76, 175, 80, 0.3);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .hero-section h1 {
            font-size: 3rem;
            margin: 0 0 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }

        .hero-section p {
            font-size: 1.2rem;
            margin: 0;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }



        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(76, 175, 80, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .search-section {
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid rgba(76, 175, 80, 0.2);
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(76, 175, 80, 0.2);
            border-radius: 25px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fdf9 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2E7D32;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-weight: 600;
        }

        .category-tabs {
            display: flex;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 8px;
            margin-bottom: 30px;
            border: 2px solid rgba(76, 175, 80, 0.2);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.1);
            flex-wrap: wrap;
            gap: 8px;
        }

        .category-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
        }

        .category-tab:hover:not(.active) {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            transform: translateY(-2px);
        }

        .category-tab.active {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            transform: translateY(-2px);
        }

        .tab-icon {
            font-size: 1.2rem;
        }

        .tab-text {
            font-weight: 600;
        }

        .tab-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .category-tab.active .tab-count {
            background: rgba(255, 255, 255, 0.3);
        }

        .plants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .plant-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fdf9 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .plant-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4CAF50, #66BB6A, #81C784);
        }

        .plant-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(76, 175, 80, 0.2);
            border-color: rgba(76, 175, 80, 0.3);
        }

        /* Bouton Ajouter à ma bibliothèque */
        .add-to-library-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .add-to-library-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .add-to-library-btn:active {
            transform: scale(0.95);
        }

        .add-to-library-btn.added {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            font-size: 20px;
        }

        .add-to-library-btn.added:hover {
            background: linear-gradient(135deg, #F57C00, #EF6C00);
        }





        .plant-icon {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 20px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
        }

        .plant-image-container {
            text-align: center;
            margin-bottom: 20px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .plant-image {
            max-width: 100%;
            max-height: 120px;
            width: auto;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .plant-image:hover {
            transform: scale(1.05);
        }

        .emoji-fallback {
            font-size: 4rem;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
        }

        .plant-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2E7D32;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .plant-info {
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(76, 175, 80, 0.05);
            border-radius: 8px;
            border-left: 3px solid #4CAF50;
        }

        .info-icon {
            font-size: 1.2rem;
            margin-right: 12px;
            color: #4CAF50;
            min-width: 25px;
        }

        .info-text {
            color: #424242;
            font-weight: 500;
        }

        .care-tips {
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        .care-tips h4 {
            color: #2E7D32;
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .care-tips h4::before {
            content: '💡';
            margin-right: 8px;
        }

        .care-tips ul {
            margin: 0;
            padding-left: 20px;
        }

        .care-tips li {
            color: #424242;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            grid-column: 1 / -1;
        }

        .no-results h3 {
            color: #4CAF50;
            margin-bottom: 20px;
        }

        .no-results p {
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .hero-section h1 {
                font-size: 2rem;
            }

            .plants-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .container {
                padding: 20px;
            }

            .plant-card {
                padding: 20px;
            }

            .stats-section {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="nav-tabs">
        <a href="index.html">🌦️ Météo</a>
        <a href="blank.html" class="active">🌱 Bibliothèque Botanique</a>
        <a href="library.html">📚 Ma Bibliothèque</a>
    </div>

    <div class="hero-section">
        <h1>🌿 Bibliothèque Botanique</h1>
        <p>Découvrez notre collection complète de plantes avec données multi-sources</p>
    </div>

    <div class="container">
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <h3>Chargement de la bibliothèque...</h3>
            <p>Récupération des données botaniques depuis notre base de données</p>
        </div>

        <div id="main-content" style="display: none;">
            <!-- Section de recherche -->
            <div class="search-section">
                <input type="text" id="search-input" class="search-input" placeholder="🔍 Rechercher une plante par nom scientifique, nom commun ou famille...">
            </div>

            <!-- Statistiques -->
            <div class="stats-section">
                <div class="stat-card">
                    <div id="total-plants" class="stat-number">0</div>
                    <div class="stat-label">Plantes Total</div>
                </div>
                <div class="stat-card">
                    <div id="flowers-count" class="stat-number">0</div>
                    <div class="stat-label">Fleurs</div>
                </div>
                <div class="stat-card">
                    <div id="trees-count" class="stat-number">0</div>
                    <div class="stat-label">Arbres</div>
                </div>
                <div class="stat-card">
                    <div id="aromatics-count" class="stat-number">0</div>
                    <div class="stat-label">Aromates</div>
                </div>
            </div>

            <!-- Onglets de catégories -->
            <div class="category-tabs">
                <button class="category-tab active" data-category="all">
                    <span class="tab-icon">🌱</span>
                    <span class="tab-text">Toutes</span>
                    <span class="tab-count" id="all-count">(0)</span>
                </button>
                <button class="category-tab" data-category="fleurs">
                    <span class="tab-icon">🌸</span>
                    <span class="tab-text">Fleurs</span>
                    <span class="tab-count" id="fleurs-count">(0)</span>
                </button>
                <button class="category-tab" data-category="arbres">
                    <span class="tab-icon">🌳</span>
                    <span class="tab-text">Arbres</span>
                    <span class="tab-count" id="arbres-count">(0)</span>
                </button>
                <button class="category-tab" data-category="potager">
                    <span class="tab-icon">🥕🍎</span>
                    <span class="tab-text">Potager</span>
                    <span class="tab-count" id="potager-count">(0)</span>
                </button>
                <button class="category-tab" data-category="aromates">
                    <span class="tab-icon">🌿</span>
                    <span class="tab-text">Aromates</span>
                    <span class="tab-count" id="aromates-count">(0)</span>
                </button>
            </div>

            <!-- Grille des plantes -->
            <div class="plants-grid" id="plants-grid">
                <!-- Les cartes de plantes seront générées dynamiquement -->
            </div>
        </div>
    </div>



    <script>
        // Système de gestion de la bibliothèque botanique - VERSION RECONSTRUITE
        class BotanicalLibrary {
            constructor() {
                this.plantsData = null;
                this.currentCategory = 'all';
                this.searchTerm = '';
                this.allPlants = [];
                this.filteredPlants = [];
                this.wikipediaService = new WikipediaImageService();
                this.imageCache = new Map();
                this.init();
            }

            async init() {
                try {
                    console.log('🚀 Initialisation de la bibliothèque botanique...');
                    await this.loadData();
                    this.setupEventListeners();
                    this.updateStats();
                    this.filterAndRenderPlants();
                    this.showMainContent();
                    console.log('✅ Bibliothèque botanique initialisée avec succès');
                } catch (error) {
                    console.error('❌ Erreur lors de l\'initialisation:', error);
                    this.showError('Erreur de chargement des données: ' + error.message);
                }
            }

            async loadData() {
                console.log('📡 Chargement des données...');

                try {
                    // Essayer de charger depuis les fichiers JSON
                    const response = await fetch('./plants_data.json');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log('📊 Données JSON chargées:', {
                        total_plants: data.metadata?.total_plants,
                        categories: data.categories,
                        plants_count: data.plants?.length
                    });

                    this.plantsData = data;
                    this.allPlants = data.plants || [];

                } catch (fetchError) {
                    console.warn('⚠️ Erreur de chargement JSON, utilisation des données de démonstration:', fetchError);

                    // Données de démonstration complètes
                    this.plantsData = {
                        metadata: {
                            total_plants: 82,
                            generated_at: new Date().toISOString(),
                            version: "2.0"
                        },
                        categories: {
                            fleurs: 13,
                            arbres: 17,
                            potager: 5,
                            aromates: 6,
                            divers: 41
                        },
                        plants: [
                            // Fleurs (13 plantes) - Photos corrigées et spécifiques
                            { id: 1, scientific_name: "Rosa rugosa", common_names: ["Rose rugueuse"], family: "Rosaceae", categories: ["fleurs:fleurs à bulbe"], description: "Belle rose sauvage résistante au froid", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Rosa_rugosa_Tokyo.JPG/400px-Rosa_rugosa_Tokyo.JPG" },
                            { id: 2, scientific_name: "Rosa damascena", common_names: ["Rose de Damas"], family: "Rosaceae", categories: ["fleurs:fleurs à bulbe"], description: "Rose célèbre pour son parfum", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f9/Damask_rose_pink.jpg/400px-Damask_rose_pink.jpg" },
                            { id: 3, scientific_name: "Rosa gallica", common_names: ["Rose de France"], family: "Rosaceae", categories: ["fleurs:fleurs à bulbe"], description: "Rose historique française", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Wild_Rosa_gallica_Romania.jpg/400px-Wild_Rosa_gallica_Romania.jpg" },
                            { id: 4, scientific_name: "Rosa centifolia", common_names: ["Rose cent-feuilles"], family: "Rosaceae", categories: ["fleurs:fleurs à bulbe"], description: "Rose à pétales multiples", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Rosa_centifolia_foliacea_17.jpg/400px-Rosa_centifolia_foliacea_17.jpg" },
                            { id: 5, scientific_name: "Iris germanica", common_names: ["Iris barbu"], family: "Iridaceae", categories: ["fleurs:fleurs à bulbe"], description: "Iris ornemental populaire", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Iris_Germanica_2012-2.jpg/400px-Iris_Germanica_2012-2.jpg" },
                            { id: 6, scientific_name: "Iris pseudacorus", common_names: ["Iris faux-acore"], family: "Iridaceae", categories: ["fleurs:fleurs à bulbe"], description: "Iris des marais", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Iris_pseudacorus_iris_des_marais.jpg/400px-Iris_pseudacorus_iris_des_marais.jpg" },
                            { id: 7, scientific_name: "Iris sibirica", common_names: ["Iris de Sibérie"], family: "Iridaceae", categories: ["fleurs:fleurs à bulbe"], description: "Iris rustique sibérien", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Sibirische_Schwertlilie%2C_Iris_sibirica_06.JPG/400px-Sibirische_Schwertlilie%2C_Iris_sibirica_06.JPG" },
                            { id: 8, scientific_name: "Lilium candidum", common_names: ["Lis blanc"], family: "Liliaceae", categories: ["fleurs:fleurs à bulbe"], description: "Lis élégant blanc", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/ShoshanTzachor-2-wiki-Zachi-Evenor.jpg/400px-ShoshanTzachor-2-wiki-Zachi-Evenor.jpg" },
                            { id: 9, scientific_name: "Lilium longiflorum", common_names: ["Lis de Pâques"], family: "Liliaceae", categories: ["fleurs:fleurs à bulbe"], description: "Lis parfumé blanc", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Lilium_longiflorum_%28Easter_Lily%29.JPG/400px-Lilium_longiflorum_%28Easter_Lily%29.JPG" },
                            { id: 10, scientific_name: "Lilium japonicum", common_names: ["Lis du Japon"], family: "Liliaceae", categories: ["fleurs:fleurs à bulbe"], description: "Lis asiatique", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/%D7%A6%D7%91%D7%A2%D7%95%D7%A0%D7%99%D7%9D.JPG/400px-%D7%A6%D7%91%D7%A2%D7%95%D7%A0%D7%99%D7%9D.JPG" },
                            { id: 11, scientific_name: "Tulipa gesneriana", common_names: ["Tulipe"], family: "Liliaceae", categories: ["fleurs:fleurs à bulbe"], description: "Tulipe cultivée classique", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/%D7%A6%D7%91%D7%A2%D7%95%D7%A0%D7%99%D7%9D.JPG/400px-%D7%A6%D7%91%D7%A2%D7%95%D7%A0%D7%99%D7%9D.JPG" },
                            { id: 12, scientific_name: "Tulipa clusiana", common_names: ["Tulipe lady"], family: "Liliaceae", categories: ["fleurs:fleurs à bulbe"], description: "Tulipe élégante", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Tulip_Tulipa_clusiana_%27Lady_Jane%27_Rock_Ledge_Flower_2000px.jpg/400px-Tulip_Tulipa_clusiana_%27Lady_Jane%27_Rock_Ledge_Flower_2000px.jpg" },
                            { id: 13, scientific_name: "Tulipa tarda", common_names: ["Tulipe tardive"], family: "Liliaceae", categories: ["fleurs:fleurs à bulbe"], description: "Tulipe de montagne", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/de/Tulipa_tarda_6.jpg/400px-Tulipa_tarda_6.jpg" },

                            // Arbres (17 plantes) - Photos corrigées et spécifiques
                            { id: 14, scientific_name: "Quercus robur", common_names: ["Chêne pédonculé"], family: "Fagaceae", categories: ["arbres:feuillus"], description: "Chêne majestueux européen", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/af/Quercus_robur.jpg/400px-Quercus_robur.jpg" },
                            { id: 15, scientific_name: "Quercus petraea", common_names: ["Chêne sessile"], family: "Fagaceae", categories: ["arbres:feuillus"], description: "Chêne robuste", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Quercus_petraea_06.jpg/400px-Quercus_petraea_06.jpg" },
                            { id: 16, scientific_name: "Quercus ilex", common_names: ["Chêne vert"], family: "Fagaceae", categories: ["arbres:feuillus"], description: "Chêne méditerranéen", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/81/Quercus_ilex_JPG1.jpg/400px-Quercus_ilex_JPG1.jpg" },
                            { id: 17, scientific_name: "Acer palmatum", common_names: ["Érable du Japon"], family: "Sapindaceae", categories: ["arbres:feuillus"], description: "Érable ornemental", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Acer_palmatum0.jpg/400px-Acer_palmatum0.jpg" },
                            { id: 18, scientific_name: "Acer pseudoplatanus", common_names: ["Érable sycomore"], family: "Sapindaceae", categories: ["arbres:feuillus"], description: "Érable européen", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Acer_pseudoplatanus_005.jpg/400px-Acer_pseudoplatanus_005.jpg" },
                            { id: 19, scientific_name: "Acer saccharum", common_names: ["Érable à sucre"], family: "Sapindaceae", categories: ["arbres:feuillus"], description: "Érable producteur de sirop", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a1/Acer_saccharum_1-jgreenlee_%285098070608%29.jpg/400px-Acer_saccharum_1-jgreenlee_%285098070608%29.jpg" },
                            { id: 20, scientific_name: "Betula pendula", common_names: ["Bouleau verruqueux"], family: "Betulaceae", categories: ["arbres:feuillus"], description: "Bouleaul gracieux", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Betula_pendula_Finland.jpg/400px-Betula_pendula_Finland.jpg" },
                            { id: 21, scientific_name: "Betula pubescens", common_names: ["Bouleaul pubescent"], family: "Betulaceae", categories: ["arbres:feuillus"], description: "Bouleaul des marais", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/71/Betula_pubescens_-_Burgwald_002.jpg/400px-Betula_pubescens_-_Burgwald_002.jpg" },
                            { id: 22, scientific_name: "Fagus sylvatica", common_names: ["Hêtre commun"], family: "Fagaceae", categories: ["arbres:feuillus"], description: "Hêtre européen", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Fagus-sylvatica-cansiglio-forest-italy.jpg/400px-Fagus-sylvatica-cansiglio-forest-italy.jpg" },
                            { id: 23, scientific_name: "Fagus grandifolia", common_names: ["Hêtre d'Amérique"], family: "Fagaceae", categories: ["arbres:feuillus"], description: "Hêtre nord-américain", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/Beech_with_Branches.jpg/400px-Beech_with_Branches.jpg" },
                            { id: 24, scientific_name: "Pinus sylvestris", common_names: ["Pin sylvestre"], family: "Pinaceae", categories: ["arbres:conifères"], description: "Pin européen", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Skuleskogen_pine.jpg/400px-Skuleskogen_pine.jpg" },
                            { id: 25, scientific_name: "Pinus nigra", common_names: ["Pin noir"], family: "Pinaceae", categories: ["arbres:conifères"], description: "Pin d'Autriche", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/%C5%9Awierklaniec_pinus_nigra_12.06.2010_p.jpg/400px-%C5%9Awierklaniec_pinus_nigra_12.06.2010_p.jpg" },
                            { id: 26, scientific_name: "Pinus halepensis", common_names: ["Pin d'Alep"], family: "Pinaceae", categories: ["arbres:conifères"], description: "Pin méditerranéen", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/%CE%A7%CE%B1%CE%BB%CE%AD%CF%80%CE%B9%CE%BF%CF%82_%CF%80%CE%B5%CF%8D%CE%BA%CE%B7_%CE%A3%CE%BF%CF%8D%CE%BD%CE%B9%CE%BF_1963.jpg/400px-%CE%A7%CE%B1%CE%BB%CE%AD%CF%80%CE%B9%CE%BF%CF%82_%CF%80%CE%B5%CF%8D%CE%BA%CE%B7_%CE%A3%CE%BF%CF%8D%CE%BD%CE%B9%CE%BF_1963.jpg" },
                            { id: 27, scientific_name: "Picea abies", common_names: ["Épicéa commun"], family: "Pinaceae", categories: ["arbres:conifères"], description: "Sapin de Noël", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/bf/GemeineFichte.jpg/400px-GemeineFichte.jpg" },
                            { id: 28, scientific_name: "Picea pungens", common_names: ["Épicéa du Colorado"], family: "Pinaceae", categories: ["arbres:conifères"], description: "Épicéa bleu", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Picea_pungens_tree.jpg/400px-Picea_pungens_tree.jpg" },
                            { id: 29, scientific_name: "Abies alba", common_names: ["Sapin blanc"], family: "Pinaceae", categories: ["arbres:conifères"], description: "Sapin argenté", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Abies_alba_Wis%C5%82a_1.jpg/400px-Abies_alba_Wis%C5%82a_1.jpg" },
                            { id: 30, scientific_name: "Abies nordmanniana", common_names: ["Sapin de Nordmann"], family: "Pinaceae", categories: ["arbres:conifères"], description: "Sapin de Noël", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d1/%C3%96r%C3%BCmcek_Orman%C4%B1_G%C3%B6knar%C4%B1_2_Tabiat_An%C4%B1t%C4%B1.jpg/400px-%C3%96r%C3%BCmcek_Orman%C4%B1_G%C3%B6knar%C4%B1_2_Tabiat_An%C4%B1t%C4%B1.jpg" },

                            // Potager - Légumes (2 plantes) - Photos corrigées
                            { id: 31, scientific_name: "Daucus carota", common_names: ["Carotte"], family: "Apiaceae", categories: ["potager:racines"], description: "Racine comestible orange", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Daucus_carota_May_2008-1_edit.jpg/400px-Daucus_carota_May_2008-1_edit.jpg" },
                            { id: 32, scientific_name: "Daucus carota subsp. sativus", common_names: ["Carotte cultivée"], family: "Apiaceae", categories: ["potager:racines"], description: "Carotte de culture", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Vegetable-Carrot-Bundle-wStalks.jpg/400px-Vegetable-Carrot-Bundle-wStalks.jpg" },

                            // Potager - Fruits (3 plantes) - Photos corrigées
                            { id: 33, scientific_name: "Solanum lycopersicum", common_names: ["Tomate"], family: "Solanaceae", categories: ["potager:légumes-fruits"], description: "Fruit rouge comestible", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/89/Tomato_je.jpg/400px-Tomato_je.jpg" },
                            { id: 34, scientific_name: "Solanum melongena", common_names: ["Aubergine"], family: "Solanaceae", categories: ["potager:légumes-fruits"], description: "Légume-fruit violet", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/76/Solanum_melongena_24_08_2012_%281%29.JPG/400px-Solanum_melongena_24_08_2012_%281%29.JPG" },
                            { id: 35, scientific_name: "Solanum tuberosum", common_names: ["Pomme de terre"], family: "Solanaceae", categories: ["potager:légumes-fruits"], description: "Tubercule comestible", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/ab/Patates.jpg/400px-Patates.jpg" },

                            // Aromates (6 plantes) - Photos corrigées
                            { id: 36, scientific_name: "Mentha piperita", common_names: ["Menthe poivrée"], family: "Lamiaceae", categories: ["aromates:fines herbes"], description: "Menthe aromatique", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Pfefferminze_natur_peppermint.jpg/400px-Pfefferminze_natur_peppermint.jpg" },
                            { id: 37, scientific_name: "Mentha spicata", common_names: ["Menthe verte"], family: "Lamiaceae", categories: ["aromates:fines herbes"], description: "Menthe douce", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Minze.jpg/400px-Minze.jpg" },
                            { id: 38, scientific_name: "Mentha × piperita", common_names: ["Menthe hybride"], family: "Lamiaceae", categories: ["aromates:fines herbes"], description: "Menthe cultivée", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Pfefferminze_natur_peppermint.jpg/400px-Pfefferminze_natur_peppermint.jpg" },
                            { id: 39, scientific_name: "Rosmarinus officinalis", common_names: ["Romarin"], family: "Lamiaceae", categories: ["aromates:fines herbes"], description: "Arbrisseau aromatique", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/Rosemary_in_bloom.JPG/400px-Rosemary_in_bloom.JPG" },
                            { id: 40, scientific_name: "Thymus vulgaris", common_names: ["Thym"], family: "Lamiaceae", categories: ["aromates:fines herbes"], description: "Thym commun", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Thymus_vulgaris1.JPG/400px-Thymus_vulgaris1.JPG" },
                            { id: 41, scientific_name: "Thymus serpyllum", common_names: ["Serpolet"], family: "Lamiaceae", categories: ["aromates:fines herbes"], description: "Thym sauvage", image_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/Thymus_serpyllum1.jpg/400px-Thymus_serpyllum1.jpg" }
                        ]
                    };

                    this.allPlants = this.plantsData.plants;
                }

                console.log(`✅ ${this.allPlants.length} plantes chargées`);
            }

            setupEventListeners() {
                console.log('🎧 Configuration des événements...');

                // Recherche
                const searchInput = document.getElementById('search-input');
                searchInput.addEventListener('input', (e) => {
                    this.searchTerm = e.target.value.trim();
                    console.log('🔍 Recherche:', this.searchTerm);
                    this.filterAndRenderPlants();
                });

                // Catégories
                const categoryTabs = document.querySelectorAll('.category-tab');
                categoryTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const category = tab.dataset.category;
                        console.log('📂 Changement de catégorie:', category);
                        this.setCategory(category);
                    });
                });
            }

            setCategory(category) {
                this.currentCategory = category;
                this.updateActiveTab();
                this.filterAndRenderPlants();
            }

            updateActiveTab() {
                const tabs = document.querySelectorAll('.category-tab');
                tabs.forEach(tab => {
                    if (tab.dataset.category === this.currentCategory) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
            }

            updateStats() {
                console.log('📊 Mise à jour des statistiques...');

                const categories = this.plantsData.categories;
                const total = this.allPlants.length;

                // Statistiques principales
                document.getElementById('total-plants').textContent = total;
                document.getElementById('fleurs-count').textContent = categories.fleurs || 0;
                document.getElementById('arbres-count').textContent = categories.arbres || 0;
                document.getElementById('aromates-count').textContent = categories.aromates || 0;

                // Compteurs des onglets
                document.getElementById('all-count').textContent = `(${total})`;
                document.getElementById('fleurs-count').textContent = `(${categories.fleurs || 0})`;
                document.getElementById('arbres-count').textContent = `(${categories.arbres || 0})`;
                document.getElementById('potager-count').textContent = `(${categories.potager || 0})`;
                document.getElementById('aromates-count').textContent = `(${categories.aromates || 0})`;
            }

            async filterAndRenderPlants() {
                console.log('🔄 Filtrage et rendu des plantes...');

                // Appliquer les filtres
                this.filteredPlants = this.applyFilters();

                console.log(`📋 ${this.filteredPlants.length} plantes filtrées`);

                // Rendre les plantes
                await this.renderPlants();
            }

            applyFilters() {
                let filtered = [...this.allPlants];

                // Filtre par catégorie
                if (this.currentCategory !== 'all') {
                    filtered = filtered.filter(plant => {
                        const categories = plant.categories || [];
                        return categories.some(cat => {
                            const catLower = cat.toLowerCase();
                            const searchLower = this.currentCategory.toLowerCase();
                            // Vérifier si la catégorie commence par le terme recherché suivi de ':'
                            return catLower.startsWith(searchLower + ':');
                        });
                    });
                }

                // Filtre par recherche
                if (this.searchTerm) {
                    const searchLower = this.searchTerm.toLowerCase();
                    filtered = filtered.filter(plant => {
                        const searchFields = [
                            plant.scientific_name || '',
                            ...(plant.common_names || []),
                            plant.family || '',
                            plant.description || ''
                        ].join(' ').toLowerCase();

                        return searchFields.includes(searchLower);
                    });
                }

                return filtered;
            }

            async renderPlants() {
                const grid = document.getElementById('plants-grid');

                if (this.filteredPlants.length === 0) {
                    grid.innerHTML = `
                        <div class="no-results">
                            <h3>🔍 Aucune plante trouvée</h3>
                            <p>Essayez de modifier vos critères de recherche ou sélectionnez une autre catégorie.</p>
                            <p><small>Catégorie actuelle: ${this.currentCategory} | Recherche: "${this.searchTerm}"</small></p>
                        </div>
                    `;
                    return;
                }

                // Limiter à 50 plantes pour performance
                const plantsToShow = this.filteredPlants.slice(0, 50);

                // Créer les cartes de plantes de manière asynchrone
                const cardPromises = plantsToShow.map(plant => this.createPlantCard(plant));
                const cards = await Promise.all(cardPromises);

                grid.innerHTML = cards.join('');

                console.log(`🎨 ${plantsToShow.length} plantes rendues`);
            }

            async createPlantCard(plant) {
                const commonName = plant.common_names && plant.common_names.length > 0
                    ? plant.common_names[0]
                    : 'Nom inconnu';

                const categoryEmoji = this.getCategoryEmoji(plant.categories);

                // Essayer de récupérer l'image depuis Wikipedia
                let imageUrl = null;
                if (this.imageCache.has(plant.scientific_name)) {
                    imageUrl = this.imageCache.get(plant.scientific_name);
                } else {
                    try {
                        imageUrl = await this.wikipediaService.getImageUrl(plant.scientific_name);
                        this.imageCache.set(plant.scientific_name, imageUrl);
                    } catch (error) {
                        console.warn(`Erreur lors de la récupération de l'image pour ${plant.scientific_name}:`, error);
                        this.imageCache.set(plant.scientific_name, null);
                    }
                }

                // Afficher l'image si elle existe, sinon l'emoji
                const imageDisplay = imageUrl
                    ? `<img src="${imageUrl}" alt="${plant.scientific_name}" class="plant-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">`
                    : '';

                const emojiFallback = imageUrl
                    ? `<div class="plant-icon emoji-fallback" style="display: none;">${categoryEmoji}</div>`
                    : `<div class="plant-icon">${categoryEmoji}</div>`;

                return `
                    <div class="plant-card" data-plant-id="${plant.id}">
                        <button class="add-to-library-btn" onclick="addToPersonalLibrary('${plant.scientific_name}', '${commonName}', '${plant.family || ''}', '${plant.categories ? plant.categories.join(',') : ''}', '${plant.description || ''}')" title="Ajouter à ma bibliothèque">
                            +
                        </button>

                        <div class="plant-image-container">
                            ${imageDisplay}
                            ${emojiFallback}
                        </div>

                        <div class="plant-name">${plant.scientific_name}</div>
                        <div class="plant-info">
                            <div class="info-item">
                                <span class="info-icon">🏷️</span>
                                <span class="info-text">Nom commun: ${commonName}</span>
                            </div>
                            ${plant.family ? `<div class="info-item">
                                <span class="info-icon">🌿</span>
                                <span class="info-text">Famille: ${plant.family}</span>
                            </div>` : ''}
                            ${plant.categories ? `<div class="info-item">
                                <span class="info-icon">📂</span>
                                <span class="info-text">Catégorie: ${plant.categories.join(', ')}</span>
                            </div>` : ''}
                        </div>

                        ${plant.description ? `<div class="care-tips">
                            <h4>Informations botaniques</h4>
                            <ul>
                                <li><strong>Description:</strong> ${plant.description}</li>
                            </ul>
                        </div>` : ''}
                    </div>
                `;
            }

            getCategoryEmoji(categories) {
                if (!categories || categories.length === 0) return '🌱';

                const category = categories[0].toLowerCase();
                if (category.includes('fleurs')) return '🌸';
                if (category.includes('arbres')) return '🌳';
                if (category.includes('potager')) return '🥕🍎';
                if (category.includes('aromates')) return '🌿';
                return '🌱';
            }

            showMainContent() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
            }

            showError(message) {
                const loadingDiv = document.getElementById('loading');
                loadingDiv.innerHTML = `
                    <h3>❌ Erreur</h3>
                    <p>${message}</p>
                    <p><small>Vérifiez la console pour plus de détails</small></p>
                `;
            }
        }

        // Système de récupération d'images Wikipedia
        class WikipediaImageService {
            constructor() {
                this.cache = new Map();
                this.baseUrl = 'https://en.wikipedia.org/api/rest_v1/page/summary/';
            }

            async getImageUrl(scientificName) {
                // Vérifier le cache d'abord
                if (this.cache.has(scientificName)) {
                    return this.cache.get(scientificName);
                }

                try {
                    console.log(`🔍 Recherche d'image pour: ${scientificName}`);

                    // Essayer d'abord avec le nom scientifique exact
                    let response = await fetch(`${this.baseUrl}${encodeURIComponent(scientificName)}`);

                    // Si ça ne marche pas, essayer avec le nom commun
                    if (!response.ok) {
                        // Essayer de récupérer le nom commun depuis les données
                        const plant = window.botanicalLibrary?.allPlants?.find(p =>
                            p.scientific_name === scientificName
                        );
                        if (plant && plant.common_names && plant.common_names.length > 0) {
                            response = await fetch(`${this.baseUrl}${encodeURIComponent(plant.common_names[0])}`);
                        }
                    }

                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const data = await response.json();

                    if (data.originalimage && data.originalimage.source) {
                        const imageUrl = data.originalimage.source;
                        this.cache.set(scientificName, imageUrl);
                        console.log(`✅ Image trouvée pour ${scientificName}: ${imageUrl}`);
                        return imageUrl;
                    }

                    // Si pas d'image originale, essayer l'image thumbnail
                    if (data.thumbnail && data.thumbnail.source) {
                        const imageUrl = data.thumbnail.source.replace('/thumb/', '/').split('/').slice(0, -1).join('/');
                        this.cache.set(scientificName, imageUrl);
                        console.log(`✅ Image thumbnail trouvée pour ${scientificName}: ${imageUrl}`);
                        return imageUrl;
                    }

                    throw new Error('Aucune image trouvée');

                } catch (error) {
                    console.warn(`⚠️ Impossible de récupérer l'image pour ${scientificName}:`, error.message);
                    this.cache.set(scientificName, null); // Cache l'échec pour éviter les requêtes répétées
                    return null;
                }
            }

            async preloadImages(plants) {
                console.log(`🚀 Préchargement des images pour ${plants.length} plantes...`);

                const promises = plants.slice(0, 10).map(async (plant) => { // Limiter à 10 pour éviter la surcharge
                    const imageUrl = await this.getImageUrl(plant.scientific_name);
                    if (imageUrl) {
                        // Précharger l'image
                        const img = new Image();
                        img.src = imageUrl;
                        return { scientific_name: plant.scientific_name, image_url: imageUrl };
                    }
                    return null;
                });

                const results = await Promise.allSettled(promises);
                const successfulLoads = results.filter(result =>
                    result.status === 'fulfilled' && result.value
                ).map(result => result.value);

                console.log(`✅ ${successfulLoads.length} images préchargées`);
                return successfulLoads;
            }
        }





        // Fonction pour ajouter une plante à la bibliothèque personnelle
        function addToPersonalLibrary(scientificName, commonName, family, categories, description) {
            try {
                console.log('🌱 Ajout de la plante à la bibliothèque personnelle:', { scientificName, commonName, family, categories, description });

                // Récupérer les plantes existantes depuis le localStorage
                let personalPlants = [];
                try {
                    const savedPlants = localStorage.getItem('personalPlants');
                    personalPlants = savedPlants ? JSON.parse(savedPlants) : [];
                } catch (error) {
                    console.warn('Erreur lors de la récupération des plantes existantes:', error);
                    personalPlants = [];
                }

                // Vérifier si la plante existe déjà (par nom scientifique)
                const existingPlant = personalPlants.find(plant =>
                    plant.scientificName === scientificName ||
                    plant.name === commonName
                );

                if (existingPlant) {
                    showNotification(`"${commonName || scientificName}" est déjà dans votre bibliothèque ! 🌱`, 'warning');
                    return;
                }

                // Générer un emoji basé sur la catégorie
                let plantIcon = '🌱';
                if (categories) {
                    const category = categories.toLowerCase();
                    if (category.includes('fleurs')) plantIcon = '🌸';
                    else if (category.includes('arbres')) plantIcon = '🌳';
                    else if (category.includes('potager')) plantIcon = '🥕';
                    else if (category.includes('aromates')) plantIcon = '🌿';
                }

                // Créer la nouvelle plante pour la bibliothèque personnelle
                const newPlant = {
                    id: Date.now().toString(),
                    name: commonName || scientificName,
                    scientificName: scientificName,
                    icon: plantIcon,
                    temperature: '15-25°C', // Valeur par défaut
                    watering: 'Modéré', // Valeur par défaut
                    sunlight: 'Soleil partiel', // Valeur par défaut
                    notes: description ? `Ajoutée depuis la bibliothèque botanique: ${description}` : 'Ajoutée depuis la bibliothèque botanique',
                    dateAdded: new Date().toLocaleDateString('fr-FR'),
                    lastWatered: null
                };

                // Ajouter à la liste
                personalPlants.push(newPlant);

                // Sauvegarder dans le localStorage
                localStorage.setItem('personalPlants', JSON.stringify(personalPlants));

                // Changer l'apparence du bouton
                const button = event.target;
                button.classList.add('added');
                button.textContent = '✓';
                button.title = 'Déjà dans la bibliothèque';
                button.disabled = true;

                // Afficher la notification de succès
                showNotification(`"${newPlant.name}" ajoutée à votre bibliothèque ! 🌱`, 'success');

                console.log('✅ Plante ajoutée avec succès à la bibliothèque personnelle');

            } catch (error) {
                console.error('❌ Erreur lors de l\'ajout à la bibliothèque:', error);
                showNotification('Erreur lors de l\'ajout à la bibliothèque', 'error');
            }
        }

        // Fonction de notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'warning' ? '#FF9800' : type === 'error' ? '#f44336' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 1001;
                font-weight: 600;
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Animations CSS pour les notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Démarrage de l\'application...');
            window.botanicalLibrary = new BotanicalLibrary();
        });
    </script>
</body>
</html>
