<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Application M√©t√©o de Rayane work in progress</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to top, #87CEEB, #ffffff);
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        label, input {
            display: block;
            margin-top: 10px;
        }

        input {
            padding: 8px;
            width: 100%;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        button {
            margin-top: 15px;
            padding: 10px 15px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        thead {
            display: none;
        }

        th, td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        th {
            background-color: #f0f0f0;
        }

        .frost-alert {
            background-color: #ffebee;
            border: 2px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }

        .frost-alert h3 {
            color: #d32f2f;
            margin: 0 0 10px 0;
            font-size: 18px;
        }

        .frost-alert p {
            color: #d32f2f;
            margin: 5px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üå¶Ô∏è Application M√©t√©o de Rayane work in progress</h1>
    <div class="container">
        <form id="weatherForm">
            <label for="latitude">Latitude :</label>
            <input type="number" id="latitude" name="latitude" step="any" value="45.48919" required>

            <label for="longitude">Longitude :</label>
            <input type="number" id="longitude" name="longitude" step="any" value="-75.675031" required>

            <div style="margin-top: 20px; margin-bottom: 20px;">
                <h3>S√©lectionnez les donn√©es √† afficher :</h3>
                <label><input type="checkbox" id="temperature_2m" name="temperature_2m" checked> Temp√©rature (¬∞C)</label>
                <label><input type="checkbox" id="relative_humidity_2m" name="relative_humidity_2m" checked> Humidit√© (%)</label>
                <label><input type="checkbox" id="precipitation" name="precipitation" checked> Pr√©cipitations (mm)</label>
                <label><input type="checkbox" id="cloud_cover" name="cloud_cover" checked> Nuages (%)</label>
                <label><input type="checkbox" id="evapotranspiration" name="evapotranspiration" checked> √âvapotranspiration (mm)</label>
                <label><input type="checkbox" id="soil_temperature_6cm" name="soil_temperature_6cm" checked> Temp√©rature du sol (¬∞C)</label>
                <label><input type="checkbox" id="soil_moisture_3_to_9cm" name="soil_moisture_3_to_9cm"> Humidit√© du sol (m¬≥/m¬≥)</label>
                <label><input type="checkbox" id="sunshine_duration" name="sunshine_duration"> Dur√©e d'ensoleillement (h)</label>
            </div>

            <button type="submit">Obtenir la m√©t√©o</button>
        </form>

        <div id="frostAlert" class="frost-alert">
            <h3>‚ö†Ô∏è Risque de gel d√©tect√©</h3>
            <p id="frostMessage"></p>
        </div>

</div>







        <table id="weatherTable">
            <thead>
                <tr>
                    <th>Heure</th>
                    <th>Temp√©rature (¬∞C)</th>
                    <th>Humidit√© (%)</th>
                    <th>Pr√©cipitations (mm)</th>
                    <th>Nuages (%)</th>
                    <th>√âvapotranspiration (mm)</th>
                    <th>Temp√©rature du sol (¬∞C)</th>
                    <th>Humidit√© du sol (m¬≥/m¬≥)</th>

                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

   <script>
document.getElementById("weatherForm").addEventListener("submit", async function (e) {
	e.preventDefault();

	const lat = document.getElementById("latitude").value;
	const lon = document.getElementById("longitude").value;

	// Get checkbox states
	const checkboxes = {
		temperature_2m: document.getElementById("temperature_2m").checked,
		relative_humidity_2m: document.getElementById("relative_humidity_2m").checked,
		precipitation: document.getElementById("precipitation").checked,
		cloud_cover: document.getElementById("cloud_cover").checked,
		evapotranspiration: document.getElementById("evapotranspiration").checked,
		soil_temperature_6cm: document.getElementById("soil_temperature_6cm").checked,
		soil_moisture_3_to_9cm: document.getElementById("soil_moisture_3_to_9cm").checked,
		sunshine_duration: document.getElementById("sunshine_duration").checked
	};

	// Check if at least one checkbox is selected
	const isAnyChecked = Object.values(checkboxes).some(checked => checked);
	if (!isAnyChecked) {
		alert("Veuillez s√©lectionner une case");
		return;
	}

	// Build API URL conditionally based on checkboxes
	let hourlyParams = [];
	if (checkboxes.temperature_2m) hourlyParams.push("temperature_2m");
	if (checkboxes.relative_humidity_2m) hourlyParams.push("relative_humidity_2m");
	if (checkboxes.precipitation) hourlyParams.push("precipitation");
	if (checkboxes.cloud_cover) hourlyParams.push("cloud_cover");
	if (checkboxes.evapotranspiration) hourlyParams.push("evapotranspiration");
	if (checkboxes.soil_temperature_6cm) hourlyParams.push("soil_temperature_6cm");
	if (checkboxes.soil_moisture_3_to_9cm) hourlyParams.push("soil_moisture_3_to_9cm");
	if (checkboxes.sunshine_duration) hourlyParams.push("sunshine_duration");

	const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=${hourlyParams.join(",")}&timezone=America%2FNew_York`;

	try {
		const response = await fetch(apiUrl);
		const data = await response.json();

		const times = data.hourly.time;

		// Get data conditionally
		const weatherData = {};
		if (checkboxes.temperature_2m) weatherData.temps = data.hourly.temperature_2m;
		if (checkboxes.relative_humidity_2m) weatherData.humidity = data.hourly.relative_humidity_2m;
		if (checkboxes.precipitation) weatherData.precipitation = data.hourly.precipitation;
		if (checkboxes.cloud_cover) weatherData.cloudCover = data.hourly.cloud_cover;
		if (checkboxes.evapotranspiration) weatherData.evapotranspiration = data.hourly.evapotranspiration;
		if (checkboxes.soil_temperature_6cm) weatherData.soilTemp = data.hourly.soil_temperature_6cm;
		if (checkboxes.soil_moisture_3_to_9cm) weatherData.soilMoisture = data.hourly.soil_moisture_3_to_9cm;
		if (checkboxes.sunshine_duration) weatherData.sunshineDuration = data.hourly.sunshine_duration.map(seconds => (seconds / 3600).toFixed(2));

		// Update table header dynamically - always show Heure column
		let headerHTML = '<th>Heure</th>';
		if (checkboxes.temperature_2m) headerHTML += '<th>Temp√©rature (¬∞C)</th>';
		if (checkboxes.relative_humidity_2m) headerHTML += '<th>Humidit√© (%)</th>';
		if (checkboxes.precipitation) headerHTML += '<th>Pr√©cipitations (mm)</th>';
		if (checkboxes.cloud_cover) headerHTML += '<th>Nuages (%)</th>';
		if (checkboxes.evapotranspiration) headerHTML += '<th>√âvapotranspiration (mm)</th>';
		if (checkboxes.soil_temperature_6cm) headerHTML += '<th>Temp√©rature du sol (¬∞C)</th>';
		if (checkboxes.soil_moisture_3_to_9cm) headerHTML += '<th>Humidit√© du sol (m¬≥/m¬≥)</th>';
		if (checkboxes.sunshine_duration) headerHTML += '<th>Dur√©e d\'ensoleillement (h)</th>';
		document.querySelector("#weatherTable thead tr").innerHTML = headerHTML;
		document.querySelector("#weatherTable thead").style.display = "table-header-group";

		const tbody = document.querySelector("#weatherTable tbody");
		tbody.innerHTML = ""; // Clear existing table

		// Display first 24 hours
		for (let i = 0; i < 24; i++) {
			const row = document.createElement("tr");

			let rowHTML = `<td>${new Date(times[i]).getHours()}h</td>`;
			if (checkboxes.temperature_2m) rowHTML += `<td>${weatherData.temps[i]}</td>`;
			if (checkboxes.relative_humidity_2m) rowHTML += `<td>${weatherData.humidity[i]}</td>`;
			if (checkboxes.precipitation) rowHTML += `<td>${weatherData.precipitation[i]}</td>`;
			if (checkboxes.cloud_cover) rowHTML += `<td>${weatherData.cloudCover[i]}</td>`;
			if (checkboxes.evapotranspiration) rowHTML += `<td>${weatherData.evapotranspiration[i]}</td>`;
			if (checkboxes.soil_temperature_6cm) rowHTML += `<td>${weatherData.soilTemp[i]}</td>`;
			if (checkboxes.soil_moisture_3_to_9cm) rowHTML += `<td>${weatherData.soilMoisture[i]}</td>`;
			if (checkboxes.sunshine_duration) rowHTML += `<td>${weatherData.sunshineDuration[i]}</td>`;

			row.innerHTML = rowHTML;
			tbody.appendChild(row);
		}

		// Check for frost risk
		if (checkboxes.temperature_2m && weatherData.temps) {
			checkFrostRisk(weatherData.temps, times);
		}
	} catch (error) {
		alert("Erreur lors de la r√©cup√©ration des donn√©es m√©t√©o.");
		console.error(error);
	}
});

// Function to check for frost risk
function checkFrostRisk(temperatures, times) {
	const frostAlert = document.getElementById("frostAlert");
	const frostMessage = document.getElementById("frostMessage");

	// Find hours with temperature <= 0¬∞C
	const frostHours = [];
	for (let i = 0; i < Math.min(temperatures.length, 24); i++) {
		if (temperatures[i] <= 0) {
			const hour = new Date(times[i]).getHours();
			frostHours.push(hour);
		}
	}

	if (frostHours.length > 0) {
		// Show frost alert
		const hourText = frostHours.length === 1 ? "heure" : "heures";
		frostMessage.textContent = `Risque de gel d√©tect√© aux ${hourText} suivantes : ${frostHours.join(", ")}h`;
		frostAlert.style.display = "block";
	} else {
		// Hide frost alert
		frostAlert.style.display = "none";
	}
}


</script>

</body>
</html>
